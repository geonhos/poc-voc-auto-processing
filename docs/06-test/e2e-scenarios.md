# E2E 테스트 시나리오

## 1. 개요

VOC 자동 처리 시스템의 End-to-End 테스트 시나리오를 정의한다.

### 1.1 테스트 목적

- 전체 흐름이 정상 동작하는지 검증
- Agent 판단의 신뢰성 확인
- 예외 케이스 처리 검증
- POC 성공 기준 충족 여부 확인

### 1.2 POC 성공 기준 (재확인)

| 기준 | 검증 방법 |
|------|-----------|
| Agent 판단 근거를 사람이 이해할 수 있는가 | 시나리오 TC-001 ~ TC-003 |
| 관리자가 승인 결정을 빠르게 내릴 수 있는가 | 시나리오 TC-004 |
| 잘못된 판단이 학습 데이터로 남는가 | 시나리오 TC-005, TC-006 |
| Ticket 상태 흐름이 실제 업무와 유사한가 | 전체 시나리오 |

---

## 2. 정상 흐름 시나리오

### TC-001: 연동사 오류 - 정상 처리

#### 시나리오 정보

| 항목 | 내용 |
|------|------|
| ID | TC-001 |
| 제목 | 연동사 오류 VOC의 정상 처리 흐름 |
| 우선순위 | 높음 |
| 문제 유형 | integration_error |

#### 사전 조건

- 시스템이 정상 동작 중
- Mock 로그 시나리오 S1 (결제 API 타임아웃) 준비

#### 테스트 데이터

```json
{
  "raw_voc": "어제 저녁에 결제를 시도했는데 한참 기다려도 결제가 안 되더라고요. 나중에 보니까 결제 실패로 되어 있었어요. 카드는 정상인데 왜 그런 건가요?",
  "customer_name": "김철수",
  "channel": "email",
  "received_at": "2024-01-15T18:30:00Z"
}
```

#### 테스트 단계

| 단계 | 액션 | 예상 결과 |
|------|------|-----------|
| 1 | VOC 입력 화면에서 테스트 데이터 입력 | 모든 필드 정상 입력 |
| 2 | [VOC 제출] 클릭 | Ticket 생성 완료, 상세 화면으로 이동 |
| 3 | Ticket 상태 확인 | OPEN → ANALYZING 자동 전이 |
| 4 | Agent 분석 완료 대기 (최대 60초) | ANALYZING → WAITING_CONFIRM 전이 |
| 5 | Agent 분석 결과 확인 | primary_type: integration_error |
| 6 | 신뢰도 확인 | 0.8 이상 (높음) |
| 7 | 판단 근거 확인 | evidence에 타임아웃 관련 로그 포함 |
| 8 | 제안 액션 확인 | action_type: integration_inquiry, 메일 초안 존재 |
| 9 | [승인] 클릭 | WAITING_CONFIRM → DONE 전이 |
| 10 | 최종 상태 확인 | status: DONE, confirmed_at 기록됨 |

#### 검증 포인트

- [ ] Ticket이 정상 생성되었는가
- [ ] Agent가 integration_error로 정확히 분류했는가
- [ ] 신뢰도가 0.6 이상인가
- [ ] 판단 근거가 명확하고 이해 가능한가
- [ ] 메일 초안이 실용적인가
- [ ] 상태 전이가 정상적인가

---

### TC-002: 코드 오류 - 정상 처리

#### 시나리오 정보

| 항목 | 내용 |
|------|------|
| ID | TC-002 |
| 제목 | 코드 오류 VOC의 정상 처리 흐름 |
| 우선순위 | 높음 |
| 문제 유형 | code_error |

#### 테스트 데이터

```json
{
  "raw_voc": "주문 상세 페이지에서 '환불 요청' 버튼을 누르면 에러가 뜹니다. 여러 번 시도해도 같은 에러가 나와요.",
  "customer_name": "박영희",
  "channel": "slack",
  "received_at": "2024-01-15T10:15:00Z"
}
```

#### 테스트 단계

| 단계 | 액션 | 예상 결과 |
|------|------|-----------|
| 1 | VOC 입력 및 제출 | Ticket 생성 |
| 2 | Agent 분석 완료 대기 | WAITING_CONFIRM 전이 |
| 3 | 분석 결과 확인 | primary_type: code_error |
| 4 | 신뢰도 확인 | 0.8 이상 |
| 5 | 제안 액션 확인 | action_type: code_fix, affected_files 존재 |
| 6 | [승인] 클릭 | DONE 전이 |

#### 검증 포인트

- [ ] NullPointerException 관련 evidence 포함
- [ ] 영향 파일 목록이 정확한가
- [ ] 수정 방향이 구체적인가

---

### TC-003: 비즈니스 개선 - 정상 처리

#### 시나리오 정보

| 항목 | 내용 |
|------|------|
| ID | TC-003 |
| 제목 | 비즈니스 개선 VOC의 정상 처리 흐름 |
| 우선순위 | 높음 |
| 문제 유형 | business_improvement |

#### 테스트 데이터

```json
{
  "raw_voc": "결제 취소하려고 하는데 버튼이 어디 있는지 모르겠어요. 주문 상세에서 한참 찾아봤는데 없고, 결국 고객센터에 전화했습니다.",
  "customer_name": "이민수",
  "channel": "email",
  "received_at": "2024-01-15T11:00:00Z"
}
```

#### 테스트 단계

| 단계 | 액션 | 예상 결과 |
|------|------|-----------|
| 1 | VOC 입력 및 제출 | Ticket 생성 |
| 2 | Agent 분석 완료 대기 | WAITING_CONFIRM 전이 |
| 3 | 분석 결과 확인 | primary_type: business_improvement |
| 4 | 신뢰도 확인 | 0.6 ~ 0.8 (중간) |
| 5 | ruled_out 확인 | 시스템 오류 제외 이유 명시 |
| 6 | 제안 액션 확인 | action_type: business_proposal, stakeholders 존재 |
| 7 | [승인] 클릭 | DONE 전이 |

#### 검증 포인트

- [ ] 에러 로그 없음이 evidence에 포함
- [ ] 개선 제안이 구체적인가
- [ ] 이해관계자 목록이 적절한가

---

## 3. 예외 흐름 시나리오

### TC-004: 관리자 거부 처리

#### 시나리오 정보

| 항목 | 내용 |
|------|------|
| ID | TC-004 |
| 제목 | 관리자가 VOC를 거부하는 흐름 |
| 우선순위 | 높음 |

#### 테스트 단계

| 단계 | 액션 | 예상 결과 |
|------|------|-----------|
| 1 | TC-001의 1~5단계 수행 | WAITING_CONFIRM 상태 |
| 2 | [거부] 클릭 | 거부 사유 모달 표시 |
| 3 | 사유 입력 없이 [거부 확인] 클릭 | 유효성 검증 오류 표시 |
| 4 | 사유 입력: "테스트용 거부" | 입력 완료 |
| 5 | [거부 확인] 클릭 | WAITING_CONFIRM → REJECTED 전이 |
| 6 | Ticket 상세 확인 | reject_reason 저장됨 |
| 7 | 목록에서 상태 확인 | REJECTED 표시 |

#### 검증 포인트

- [ ] 거부 사유 없이 거부 불가
- [ ] 거부 사유가 정상 저장되었는가
- [ ] REJECTED 상태에서 추가 액션 불가

---

### TC-005: 재분석 요청 처리

#### 시나리오 정보

| 항목 | 내용 |
|------|------|
| ID | TC-005 |
| 제목 | 관리자가 재분석을 요청하는 흐름 |
| 우선순위 | 중간 |

#### 테스트 단계

| 단계 | 액션 | 예상 결과 |
|------|------|-----------|
| 1 | WAITING_CONFIRM 상태 Ticket 준비 | - |
| 2 | [재분석] 클릭 | WAITING_CONFIRM → ANALYZING 전이 |
| 3 | Agent 재분석 완료 대기 | ANALYZING → WAITING_CONFIRM 전이 |
| 4 | 분석 결과 확인 | 새로운 analyzed_at 기록 |

#### 검증 포인트

- [ ] 재분석 후 상태가 정상 전이되는가
- [ ] 분석 결과가 갱신되었는가

---

### TC-006: 정규화 실패 - 수동 처리

#### 시나리오 정보

| 항목 | 내용 |
|------|------|
| ID | TC-006 |
| 제목 | 정규화 실패 시 수동 처리 흐름 |
| 우선순위 | 높음 |

#### 테스트 데이터

```json
{
  "raw_voc": "ㅋㅋㅋㅋㅋ",
  "customer_name": "테스트",
  "channel": "slack",
  "received_at": "2024-01-15T12:00:00Z"
}
```

#### 테스트 단계

| 단계 | 액션 | 예상 결과 |
|------|------|-----------|
| 1 | VOC 입력 및 제출 | Ticket 생성 |
| 2 | 상태 확인 | MANUAL_REQUIRED 상태 |
| 3 | Ticket 상세 확인 | "수동 처리 필요" 안내 표시 |
| 4 | Agent 분석 결과 | 없음 (정규화 실패) |
| 5 | 처리 결과 입력 | "비정상 VOC로 판단하여 종료" |
| 6 | [수동 처리 완료] 클릭 | MANUAL_REQUIRED → DONE 전이 |
| 7 | manual_resolution 확인 | 입력 내용 저장됨 |

#### 검증 포인트

- [ ] 정규화 실패 VOC가 MANUAL_REQUIRED로 처리되는가
- [ ] 수동 처리 결과가 저장되는가

---

### TC-007: 저신뢰도 - Fallback 처리

#### 시나리오 정보

| 항목 | 내용 |
|------|------|
| ID | TC-007 |
| 제목 | 저신뢰도 분석 시 수동 처리 전환 |
| 우선순위 | 높음 |

#### 테스트 데이터

```json
{
  "raw_voc": "뭔가 이상해요. 자세히는 모르겠는데 예전이랑 다른 것 같아요.",
  "customer_name": "최지은",
  "channel": "email",
  "received_at": "2024-01-15T09:00:00Z"
}
```

#### 테스트 단계

| 단계 | 액션 | 예상 결과 |
|------|------|-----------|
| 1 | VOC 입력 및 제출 | Ticket 생성, ANALYZING 전이 |
| 2 | Agent 분석 완료 대기 | MANUAL_REQUIRED 전이 (confidence < 0.6) |
| 3 | Ticket 상세 확인 | "증거 부족" 안내 표시 |
| 4 | 수동 처리 완료 | DONE 전이 |

#### 검증 포인트

- [ ] 신뢰도 0.6 미만 시 MANUAL_REQUIRED로 전환되는가
- [ ] 저신뢰도 사유가 표시되는가

---

### TC-008: 긴급 Ticket Slack 알림

#### 시나리오 정보

| 항목 | 내용 |
|------|------|
| ID | TC-008 |
| 제목 | 긴급 Ticket 생성 시 Slack 알림 발송 |
| 우선순위 | 중간 |

#### 사전 조건

- Slack Webhook 연동 완료

#### 테스트 단계

| 단계 | 액션 | 예상 결과 |
|------|------|-----------|
| 1 | urgency: high가 예상되는 VOC 입력 | Ticket 생성 |
| 2 | 정규화 결과 확인 | urgency: high |
| 3 | Slack 채널 확인 | 알림 메시지 수신 |
| 4 | 알림 내용 확인 | ticket_id, summary, urgency 포함 |

#### 검증 포인트

- [ ] high 긴급도 Ticket에만 알림 발송
- [ ] 알림 내용이 정확한가

---

### TC-009: Agent 타임아웃

#### 시나리오 정보

| 항목 | 내용 |
|------|------|
| ID | TC-009 |
| 제목 | Agent 처리 타임아웃 시 Fallback |
| 우선순위 | 중간 |

#### 테스트 단계

| 단계 | 액션 | 예상 결과 |
|------|------|-----------|
| 1 | (타임아웃 시뮬레이션 필요) | - |
| 2 | 60초 초과 시 | ANALYZING → MANUAL_REQUIRED 전이 |
| 3 | Ticket 상세 확인 | "분석 타임아웃" 안내 표시 |

#### 검증 포인트

- [ ] 60초 타임아웃이 정상 동작하는가
- [ ] 타임아웃 시 MANUAL_REQUIRED로 전환되는가

---

## 4. UI 검증 시나리오

### TC-010: Ticket 목록 필터링

| 단계 | 액션 | 예상 결과 |
|------|------|-----------|
| 1 | 상태 필터: WAITING_CONFIRM 선택 | 해당 상태만 표시 |
| 2 | 긴급도 필터: high 선택 | 해당 긴급도만 표시 |
| 3 | 정렬: 긴급도 높은 순 | high → medium → low 순서 |
| 4 | 페이지네이션 | 정상 동작 |

### TC-011: 유효성 검증

| 단계 | 액션 | 예상 결과 |
|------|------|-----------|
| 1 | VOC 내용 없이 제출 | 에러 메시지 표시 |
| 2 | 5000자 초과 입력 | 입력 제한 또는 에러 |
| 3 | 미래 날짜 입력 | 에러 메시지 표시 |

---

## 5. 테스트 데이터 요약

### 5.1 VOC 샘플

| ID | VOC 원문 (요약) | 예상 유형 | 예상 긴급도 |
|----|-----------------|-----------|-------------|
| VOC-S1 | 결제 타임아웃 | integration_error | high |
| VOC-S2 | 환불 버튼 에러 | code_error | medium |
| VOC-S3 | 버튼 위치 문의 | business_improvement | low |
| VOC-S4 | 결제 시스템 오류 (복합) | integration_error + code_error | high |
| VOC-S5 | 모호한 문의 | 불명확 (MANUAL_REQUIRED) | low |
| VOC-S6 | 비정상 입력 | 정규화 실패 | - |

### 5.2 Mock 로그 시나리오 매핑

| VOC | Mock 로그 시나리오 |
|-----|-------------------|
| VOC-S1 | S1: 결제 API 타임아웃 |
| VOC-S2 | S2: NullPointerException |
| VOC-S3 | S3: 에러 없음 (정상 로그) |
| VOC-S4 | S4: 복합 오류 |
| VOC-S5 | S5: 로그 부족 |

---

## 6. 테스트 체크리스트

### 6.1 기능 테스트

- [ ] VOC 입력 및 Ticket 생성
- [ ] 정규화 Agent 정상 동작
- [ ] Issue Solver Agent 정상 동작
- [ ] 상태 전이 정상 동작
- [ ] 관리자 Approve/Reject/Retry
- [ ] 수동 처리 완료
- [ ] Slack 알림 발송

### 6.2 예외 처리 테스트

- [ ] 정규화 실패 처리
- [ ] 저신뢰도 Fallback
- [ ] Agent 타임아웃 처리
- [ ] 유효성 검증 오류 처리

### 6.3 UI 테스트

- [ ] 목록 필터링/정렬
- [ ] 상세 화면 정보 표시
- [ ] 로딩 상태 표시
- [ ] 에러 메시지 표시

---

## 7. 데모 시나리오

POC 시연을 위한 권장 시나리오:

1. **정상 흐름 시연 (TC-001)**
   - VOC 입력 → Agent 분석 → 승인 → 완료

2. **Agent 판단력 시연 (TC-001, TC-002, TC-003)**
   - 각 유형별 정확한 분류 확인
   - 판단 근거의 명확성 확인

3. **예외 처리 시연 (TC-006)**
   - 정규화 실패 → 수동 처리

4. **관리자 개입 시연 (TC-004)**
   - 거부 사유 입력 → 종료

5. **긴급 알림 시연 (TC-008)**
   - 긴급 VOC → Slack 알림 확인
