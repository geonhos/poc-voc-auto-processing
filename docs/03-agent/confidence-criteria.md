# 신뢰도 기준 정의

## 1. 개요

Agent 판단의 신뢰도(decision_confidence) 산정 기준과 활용 방안을 정의한다.

---

## 2. 신뢰도 정의

### 2.1 개념

| 항목 | 설명 |
|------|------|
| 정의 | Agent가 자신의 판단에 대해 가지는 확신도 |
| 범위 | 0.0 ~ 1.0 |
| 목적 | 자동 처리 vs 수동 개입 분기 판단 |

### 2.2 신뢰도의 의미

- 신뢰도는 **판단의 정확성 보장**이 아니다
- 신뢰도는 **판단 근거의 충분성**을 나타낸다
- 높은 신뢰도 = 명확한 증거 존재
- 낮은 신뢰도 = 증거 부족 또는 모호함

---

## 3. 신뢰도 산정 기준

### 3.1 산정 요소

| 요소 | 가중치 | 설명 |
|------|--------|------|
| 로그 증거 명확성 | 40% | 관련 에러 로그 존재 및 명확성 |
| 패턴 일치도 | 30% | 알려진 문제 패턴과의 일치 정도 |
| VOC-로그 연관성 | 20% | VOC 내용과 로그의 상관관계 |
| 유형 일관성 | 10% | suspected_type과 분석 결과 일치 여부 |

### 3.2 요소별 상세 기준

#### 로그 증거 명확성 (40%)

| 점수 | 조건 |
|------|------|
| 1.0 | 명확한 에러 로그 + 스택 트레이스 존재 |
| 0.8 | 에러 로그 존재, 원인 특정 가능 |
| 0.6 | 에러 로그 존재, 원인 추정 필요 |
| 0.4 | 간접적 로그만 존재 |
| 0.2 | 관련 로그 거의 없음 |
| 0.0 | 로그 없음 |

#### 패턴 일치도 (30%)

| 점수 | 조건 |
|------|------|
| 1.0 | 과거 동일 패턴 다수 존재 |
| 0.7 | 유사 패턴 존재 |
| 0.4 | 부분적 패턴 일치 |
| 0.0 | 새로운 패턴 |

#### VOC-로그 연관성 (20%)

| 점수 | 조건 |
|------|------|
| 1.0 | VOC 시점과 로그 시점 일치, 내용 연관 |
| 0.7 | 시점 일치, 내용 부분 연관 |
| 0.4 | 시점 또는 내용 중 하나만 연관 |
| 0.0 | 연관성 불명확 |

#### 유형 일관성 (10%)

| 점수 | 조건 |
|------|------|
| 1.0 | suspected_type과 분석 결과 일치 |
| 0.5 | 부분 일치 (primary만 일치) |
| 0.0 | 불일치 (유형 변경 필요) |

---

## 4. 신뢰도 수준 정의

### 4.1 수준별 정의

| 범위 | 수준 | 의미 |
|------|------|------|
| 0.8 ~ 1.0 | 높음 (High) | 명확한 증거로 확신 있는 판단 |
| 0.6 ~ 0.8 | 중간 (Medium) | 부분적 증거, 합리적 추론 포함 |
| 0.4 ~ 0.6 | 낮음 (Low) | 증거 부족, 추론 비중 높음 |
| 0.0 ~ 0.4 | 매우 낮음 (Very Low) | 거의 추론에 의존 |

### 4.2 수준별 처리

| 수준 | 상태 전이 | 관리자 안내 |
|------|-----------|-------------|
| 높음 | WAITING_CONFIRM | "Agent가 높은 확신으로 판단했습니다" |
| 중간 | WAITING_CONFIRM | "일부 추론이 포함되어 있습니다. 근거를 확인해주세요" |
| 낮음 | MANUAL_REQUIRED | "증거가 부족합니다. 수동 분석이 필요합니다" |
| 매우 낮음 | MANUAL_REQUIRED | "판단 근거를 찾지 못했습니다. 수동 분석이 필요합니다" |

---

## 5. 임계값 설정

### 5.1 Fallback 임계값

| 항목 | 값 | 설명 |
|------|-----|------|
| 자동 처리 임계값 | 0.6 | 이상이면 WAITING_CONFIRM |
| 수동 처리 임계값 | 0.6 미만 | MANUAL_REQUIRED |

### 5.2 임계값 선정 근거

- 0.6은 "최소한의 합리적 근거"를 의미
- 너무 높으면 (0.8+) 대부분 수동 처리로 전환
- 너무 낮으면 (0.4-) 잘못된 판단이 관리자에게 전달

---

## 6. 신뢰도 활용

### 6.1 상태 전이 결정

```python
if decision_confidence >= 0.6:
    ticket.status = "WAITING_CONFIRM"
else:
    ticket.status = "MANUAL_REQUIRED"
```

### 6.2 UI 표시

| 신뢰도 범위 | 표시 방식 |
|-------------|-----------|
| 0.8+ | 초록색 뱃지 "높은 신뢰도" |
| 0.6 ~ 0.8 | 노란색 뱃지 "중간 신뢰도" |
| 0.6 미만 | 빨간색 뱃지 "낮은 신뢰도" (MANUAL_REQUIRED) |

### 6.3 근거 표시 상세도

| 신뢰도 범위 | 근거 표시 |
|-------------|-----------|
| 0.8+ | evidence만 표시 |
| 0.6 ~ 0.8 | evidence + ruled_out 모두 표시 |
| 0.6 미만 | evidence + ruled_out + "증거 부족 경고" 표시 |

---

## 7. 예시

### 7.1 높은 신뢰도 (0.85)

```json
{
  "decision_confidence": 0.85,
  "confidence_breakdown": {
    "log_evidence": 0.9,
    "pattern_match": 0.8,
    "voc_log_correlation": 0.8,
    "type_consistency": 1.0
  },
  "confidence_reason": "명확한 에러 로그와 스택 트레이스가 존재하며, 과거 유사 패턴이 확인됨"
}
```

### 7.2 중간 신뢰도 (0.68)

```json
{
  "decision_confidence": 0.68,
  "confidence_breakdown": {
    "log_evidence": 0.6,
    "pattern_match": 0.7,
    "voc_log_correlation": 0.7,
    "type_consistency": 1.0
  },
  "confidence_reason": "에러 로그는 존재하나 직접적 원인 특정에 일부 추론이 필요함"
}
```

### 7.3 낮은 신뢰도 (0.45)

```json
{
  "decision_confidence": 0.45,
  "confidence_breakdown": {
    "log_evidence": 0.4,
    "pattern_match": 0.4,
    "voc_log_correlation": 0.5,
    "type_consistency": 0.5
  },
  "confidence_reason": "관련 로그가 부족하고 유사 패턴을 찾지 못함. 수동 분석 권장"
}
```

---

## 8. 향후 개선 방향

### 8.1 학습 기반 보정

| 데이터 | 활용 |
|--------|------|
| Approve 이력 | 해당 신뢰도 수준의 정확도 검증 |
| Reject 이력 | 잘못된 판단 패턴 분석 |
| Retry 이력 | 개선 필요 영역 식별 |

### 8.2 임계값 동적 조정

- 초기: 고정 임계값 0.6
- 향후: Reject 비율 기반 동적 조정 검토
